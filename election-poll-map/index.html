<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2026 지방선거 여론조사 시각화</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Leaflet (지도) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.css">
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.min.js"></script>

  <!-- 스타일시트 -->
  <link rel="stylesheet" href="css/style.css">

  <style>
    /* Folium 지도 내장 스타일 */
    #mapContainer iframe {
      border: none;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body data-theme="light">
  <div id="container">
    <!-- 헤더 -->
    <header>
      <h1>📊 2026 지방선거 여론조사 시각화</h1>
      <div class="subtitle">NESDC 기반 전국 여론조사 실시간 트래킹</div>
    </header>

    <!-- 메인 콘텐츠 -->
    <div id="main">
      <!-- 사이드바 (컨트롤 패널) -->
      <div id="sidebar">
        <h3>🗺️ 지역 선택</h3>
        <div class="control-group">
          <label for="regionSelect">광역지자체:</label>
          <select id="regionSelect">
            <option value="">지역을 선택하세요...</option>
          </select>
        </div>

        <div id="selectedRegionText">선택 없음</div>

        <h3>📈 시간 범위</h3>
        <div class="control-group">
          <label for="daysFilter">조사 기간:</label>
          <select id="daysFilter">
            <option value="7">최근 7일</option>
            <option value="30" selected>최근 30일</option>
            <option value="90">최근 90일</option>
            <option value="180">최근 180일</option>
            <option value="0">전체 기간</option>
          </select>
        </div>

        <h3>⚙️ 도구</h3>
        <button class="btn btn-secondary btn-small" onclick="exportDataAsJSON()">
          💾 JSON 내보내기
        </button>
        <button class="btn btn-secondary btn-small" onclick="exportDataAsCSV()">
          📋 CSV 내보내기
        </button>
        <button class="btn btn-secondary btn-small" onclick="printRegionStats()">
          📊 통계 보기
        </button>
        <button class="btn btn-secondary btn-small" onclick="toggleDarkMode()">
          🌙 다크모드
        </button>

        <button class="btn btn-primary" onclick="resetView()">
          🔄 초기화
        </button>

        <h3>ℹ️ 정보</h3>
        <div class="info-box">
          <strong>마지막 업데이트</strong>
          <span id="lastUpdate">로딩 중...</span>
        </div>

        <div class="info-box">
          <strong>범례</strong>
          <div style="margin-top: 8px;">
            <div style="margin-bottom: 4px;">
              <span style="display:inline-block; width:10px; height:10px; background-color:#3b82f6; border-radius:50%; margin-right:4px;"></span>
              <span>민주당 우위</span>
            </div>
            <div style="margin-bottom: 4px;">
              <span style="display:inline-block; width:10px; height:10px; background-color:#ef4444; border-radius:50%; margin-right:4px;"></span>
              <span>국민의힘 우위</span>
            </div>
            <div>
              <span style="display:inline-block; width:10px; height:10px; background-color:#8b949e; border-radius:50%; margin-right:4px;"></span>
              <span>기타 후보 우위</span>
            </div>
          </div>
        </div>

        <div class="info-box">
          <strong>사용 방법</strong>
          <div style="margin-top: 8px; line-height: 1.5;">
            1. 왼쪽에서 지역 선택<br>
            2. 원하는 기간 설정<br>
            3. 차트에서 추이 확인<br>
            4. 데이터 내보내기 가능
          </div>
        </div>
      </div>

      <!-- 지도 영역 -->
      <div id="mapContainer">
        <iframe id="mapFrame" src="map.html" style="border:none;"></iframe>
      </div>

      <!-- 차트 영역 -->
      <div id="chartContainer">
        <div id="error"></div>
        <canvas id="pollChart"></canvas>
      </div>
    </div>

    <!-- 푸터 -->
    <footer>
      <p>
        📍 데이터 출처: NESDC (National Election Survey Data Center) |
        🔗 <a href="https://www.nesdc.go.kr" target="_blank">NESDC 바로가기</a> |
        ℹ️ 이 페이지는 교육 및 분석 목적으로 제작되었습니다.
      </p>
    </footer>
  </div>

  <!-- 스크립트 -->
  <script src="js/data.js"></script>
  <script src="js/chart.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
